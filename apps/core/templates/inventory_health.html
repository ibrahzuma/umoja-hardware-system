{% extends 'base.html' %}

{% block content %}
<h2 class="text-primary fw-bold mb-4">Inventory Health Report</h2>

<div class="card shadow-sm">
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0" id="reportTable">
                <thead class="bg-light">
                    <tr>
                        <th>Product</th>
                        <th>Branch</th>
                        <th>Stock</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="reportBody">
                    <tr>
                        <td colspan="4">Loading...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', async () => {
        const resp = await fetch('/api/stocks/');
        const stocks = await resp.json();
        const tbody = document.getElementById('reportBody');
        tbody.innerHTML = '';

        stocks.forEach(s => {
            let status = '<span class="badge bg-success">Healthy</span>';
            if (s.quantity === 0) status = '<span class="badge bg-dark">Out of Stock</span>';
            else if (s.quantity <= s.low_stock_threshold) status = '<span class="badge bg-danger">Low Stock</span>';

            tbody.innerHTML += `
                <tr>
                    <td class="fw-bold">${s.product_name}</td>
                    <td>${s.branch_name}</td>
                    <td>${s.quantity}</td>
                    <td>${status}</td>
                </tr>`;
        });
    });
</script>
{% endblock %}